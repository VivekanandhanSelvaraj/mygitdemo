/* 03-NOV-2025	Vivekanandhan Selvaraj	DX_DMND0002326	Ramp web services integratiing with PeopleSoft */

/* Start	03-NOV-2025	Vivekanandhan Selvaraj	DX_DMND0002326	Ramp web services integratiing with PeopleSoft */

import DX_API:consumer:ramp:*;

class users extends DX_API:consumer:ramp:authorization
   method users();
   method RampUsersCreate() Returns string;
   method RampUsersGet() Returns string;
   rem method RampCustomRecordsGet() Returns string;
   method RampCustomRecordsUpdate() Returns string;
   method RampUsersUpdate() Returns string;
   method RampUsersRehire() Returns string;
   method RampUsersTerm() Returns string;
   method RampDepartment() Returns string;
   method RampLocation() Returns string;
   method RampEntity() Returns string;
end-class;

method users
   Local string &strToken;
   %Super = create DX_API:consumer:ramp:authorization();
   &strToken = %Super.propstr_GeneratedAccessToken;
   rem MessageBox(0, "", 0, 0, "Token in User Constructor " | %Super.propstr_GeneratedAccessToken);
end-method;

method RampUsersCreate
   /+ Returns String +/
   
   Local string &id;
   Local string &jsonResponseString;
   Local integer &nbPostCount;
   Local SQL &sqlPostDataSelect;
   Local Record &recRampUser;
   
   Local Document &docUriDocument;
   Local Compound &comUriCompound;
   
   Local JsonParser &js_parser;
   Local JsonObject &js_rootObj;
   Local JsonArray &js_DataArray;
   Local JsonObject &js_DataObj;
   Local JsonObject &pageObj;
   
   Local integer &ui;
   Local string &tokenType, &accessToken;
   Local string &nextUrl;
   
   Local string &strRequestString;
   Local string &strRamp_TempUserID;
   Local string &strRamp_emplid;
   Local number &numRamp_empl_rcd;
   Local string &strRamp_hr_status;
   Local string &strRamp_empl_status;
   Local string &strRamp_elig_config5;
   Local string &strRamp_emailid;
   Local string &strRamp_first_name;
   Local string &strRamp_last_name;
   Local string &strRamp_manager;
   Local string &strRamp_location;
   Local string &strRamp_manager_id;
   Local string &strRamp_phone;
   Local string &strRamp_deptid;
   Local string &strRamp_chartfield1;
   Local string &strRamp_chartfield2;
   Local string &strRamp_chartfield3;
   Local string &strRamp_product;
   Local string &strRamp_operating_unit;
   Local string &strRamp_company;
   Local datetime &datetimeRamp_last_update_dttm;
   Local date &dateRamp_termination_dt;
   Local date &dateRamp_asgn_end_dt;
   Local string &strRamp_text254;
   Local string &strRamp_status;
   Local boolean &bValidateUserKey;
   Local string &strIsManager;
   Local string &strRamp_Role;
   
   SQLExec(SQL.DX_RAMP_CR_CH_SQL, &nbPostCount);
   If &nbPostCount > 0 Then
      &sqlPostDataSelect = CreateSQL(SQL.DX_RAMP_CR_SQL);
   Else
      rem MessageBox(0, "", 0, 0, "Given Data already exist in the PeopleSoft system. Create new account is invalid, try update the account.");
      MessageBox(0, "", 0, 0, MsgGetExplainText(20020, 6, "New account create data not available"));
   End-If;
   &strRamp_TempUserID = "Dexian_Ramp" | %Datetime;
   /* While &sqlPostDataSelect.Fetch(&strRamp_emplid, &numRamp_empl_rcd, &strRamp_hr_status, &strRamp_empl_status, &strRamp_elig_config5, &strRamp_emailid, &strRamp_first_name, &strRamp_last_name, &strRamp_manager, &strRamp_location, &strRamp_manager_id, &strRamp_phone, &strRamp_deptid, &strRamp_chartfield1, &strRamp_chartfield2, &strRamp_chartfield3, &strRamp_product, &strRamp_operating_unit, &strRamp_company, &datetimeRamp_last_update_dttm, &dateRamp_termination_dt, &dateRamp_asgn_end_dt, &strRamp_text254, &strRamp_status)*/
   While &sqlPostDataSelect.Fetch(&strRamp_emplid, &numRamp_empl_rcd, &strRamp_hr_status, &strRamp_empl_status, &strRamp_elig_config5, &strRamp_emailid, &strRamp_first_name, &strRamp_last_name, &strRamp_manager, &strRamp_manager_id, &strRamp_phone, &strRamp_deptid, &strRamp_chartfield1, &strRamp_chartfield2, &strRamp_chartfield3, &strRamp_product, &strRamp_operating_unit, &strRamp_company, &datetimeRamp_last_update_dttm, &dateRamp_termination_dt, &dateRamp_asgn_end_dt, &strRamp_text254, &strRamp_status)
      &strRamp_deptid = "031";
      &strRamp_location = "e86ea6ac-4619-4074-abdf-b66140ec5adc";
      If &strRamp_first_name = "XXXXXXXXXX" Then
         &strRamp_first_name = "Cristiano";
      End-If;
      If &strRamp_last_name = "XXXXXXXXXX" Then
         &strRamp_last_name = "LastName_" | Int(Rand() * 100);
      End-If;
      If &strRamp_emailid = "psnonprod-notifications@disys.com" Then
         &strRamp_emailid = "vivek.selvaraj@dexian.com";
      End-If;
      &strIsManager = "false";
      &strRamp_Role = "BUSINESS_USER";
      
      SQLExec("SELECT D.DX_RAMP_DEP_ID FROM PS_DX_RAMP_DEPT D WHERE D.DEPTID = :1 ", &strRamp_deptid, &strRamp_deptid);
      rem SQLExec("SELECT L.DX_RAMP_LOC_ID FROM PS_DX_RAMP_LOC L WHERE L.LOCATION = :1 ", &strRamp_location, &strRamp_location);
      SQLExec("SELECT U.DX_RAMP_UUID FROM PS_DX_RAMP_USER U WHERE U.EMPLOYEE_ID = :1 AND UPPER(U.MANAGER) = 'Y' ", &strRamp_manager_id, &strRamp_manager_id);
      
      &strRequestString = GetHTMLText(HTML.DX_RAMP_USER_POST_REQ, &strRamp_TempUserID, &strRamp_deptid, &strRamp_location, &strRamp_manager_id, &strRamp_first_name, &strRamp_last_name, &strRamp_emailid, &strIsManager, &strRamp_Role);
      rem &strRequestString = GetHTMLText(HTML.DX_RAMP_USER_POST_REQ, &strRamp_TempUserID, &strRamp_deptid, &strRamp_manager_id, &strRamp_first_name, &strRamp_last_name, &strRamp_emailid, &strIsManager, &strRamp_Role);
      rem &strRequestString = GetHTMLText(HTML.DX_RAMP_TEST_POST_REQ, &strRamp_TempUserID); /* Used only for the testing. Comment it afterwards. */
      
      &jsonResponseString = %Super.SendMessage("DX_RAMP_USER_POST", "", 1, &strRequestString, "");
      
      /* Create parser object */
      &js_parser = CreateJsonParser();
      
      /* Parse JSON string */
      If &js_parser.Parse(&jsonResponseString) Then
         /* Get root JSON object */
         &js_rootObj = &js_parser.GetRootObject();
         &id = &js_rootObj.GetString("id");
         
         MessageBox(0, "", 0, 0, "New User &id : " | &id);
         &recRampUser = CreateRecord(Record.DX_RAMP_USER_NW);
         &recRampUser.DX_RAMP_IDEMP_KEY.Value = &id;
         &recRampUser.DX_RAMP_UUID.Value = &id;
         &recRampUser.LAST_NAME.Value = &strRamp_last_name;
         &bValidateUserKey = &recRampUser.SelectByKey();
         
         &recRampUser.DX_RAMP_IDEMP_KEY.Value = &id;
         &recRampUser.DX_RAMP_UUID.Value = &id;
         &recRampUser.EMPLOYEE_ID.Value = &strRamp_emplid;
         rem &recRampUser.DX_RAMP_LOC_ID.Value = &strRamp_location;
         &recRampUser.DX_RAMP_ENT_ID.Value = &strRamp_company;
         &recRampUser.DX_RAMP_MGR_ID.Value = &strRamp_manager_id;
         &recRampUser.DX_RAMP_DEP_ID.Value = &strRamp_deptid;
         &recRampUser.DX_RAMP_BUS_ID.Value = &strRamp_operating_unit;
         &recRampUser.FIRST_NAME.Value = &strRamp_first_name;
         &recRampUser.LAST_NAME.Value = &strRamp_last_name;
         &recRampUser.EMAILID.Value = &strRamp_emailid;
         &recRampUser.PHONE.Value = "";
         &recRampUser.ROLENAME.Value = "BUSINESS_USER";
         &recRampUser.STATUSIMG.Value = "Create";
         &recRampUser.MANAGER.Value = True;
         &recRampUser.LASTUPDOPRID.Value = %OperatorId;
         &recRampUser.LASTUPDDTTM.Value = %Datetime;
         If &bValidateUserKey Then
            &recRampUser.Update();
         Else
            &recRampUser.Insert();
         End-If;
         
         /* Use the extracted values - here just a message box */
         rem MessageBox(0, "", 0, 0, "ID: " | &id | Char(13) | "Name: " | &name);
      Else
      End-If;
   End-While;
   
   Return &id;
end-method;


method RampCustomRecordsUpdate
   /+ Returns String +/
   
   Local string &id;
   Local string &jsonResponseString;
   Local integer &nbPostCount;
   Local SQL &sqlPostDataSelect;
   Local Record &recRampUser;
   
   Local Document &docUriDocument;
   Local Compound &comUriCompound;
   
   Local JsonParser &js_parser;
   Local JsonObject &js_rootObj;
   Local JsonArray &js_DataArray;
   Local JsonObject &js_DataObj;
   Local JsonObject &pageObj;
   
   Local integer &ui;
   Local string &tokenType, &accessToken;
   Local string &nextUrl;
   
   Local string &strRequestString;
   Local string &strRamp_UUID;
   Local string &strRamp_TempUserID;
   Local string &strRamp_emplid;
   Local number &numRamp_empl_rcd;
   Local string &strRamp_hr_status;
   Local string &strRamp_empl_status;
   Local string &strRamp_elig_config5;
   Local string &strRamp_emailid;
   Local string &strRamp_first_name;
   Local string &strRamp_last_name;
   Local string &strRamp_manager;
   Local string &strRamp_location;
   Local string &strRamp_manager_id;
   Local string &strRamp_phone;
   Local string &strRamp_deptid;
   Local string &strRamp_chartfield1;
   Local string &strRamp_chartfield2;
   Local string &strRamp_chartfield3;
   Local string &strRamp_product;
   Local string &strRamp_operating_unit;
   Local string &strRamp_company;
   Local datetime &datetimeRamp_last_update_dttm;
   Local date &dateRamp_termination_dt;
   Local date &dateRamp_asgn_end_dt;
   Local string &strRamp_text254;
   Local string &strRamp_status;
   Local string &strRamp_Role;
   
   Local boolean &bValidateUserKey;
   Local string &strIsManager;
   Local string &strRamp_Action;
   Local string &strRamp_projectid;
   
   SQLExec(SQL.DX_RAMP_CUS_CH_SQL, &nbPostCount);
   If &nbPostCount > 0 Then
      &sqlPostDataSelect = CreateSQL(SQL.DX_RAMP_CUS_SQL);
   Else
      rem MessageBox(0, "", 0, 0, "Given Data already exist in the PeopleSoft system. Create new account is invalid, try update the account.");
      MessageBox(0, "", 0, 0, MsgGetExplainText(20020, 6, "Update data not available"));
   End-If;
   &strRamp_TempUserID = "LastName_" | Int(Rand() * 100);
   
   While &sqlPostDataSelect.Fetch(&strRamp_emplid, &numRamp_empl_rcd, &strRamp_hr_status, &strRamp_empl_status, &strRamp_elig_config5, &strRamp_emailid, &strRamp_first_name, &strRamp_last_name, &strRamp_manager, &strRamp_location, &strRamp_manager_id, &strRamp_phone, &strRamp_deptid, &strRamp_chartfield1, &strRamp_chartfield2, &strRamp_chartfield3, &strRamp_product, &strRamp_projectid, &strRamp_operating_unit, &strRamp_company, &datetimeRamp_last_update_dttm, &dateRamp_termination_dt, &dateRamp_asgn_end_dt, &strRamp_Action, &strRamp_text254, &strRamp_status)
      rem While &sqlPostDataSelect.Fetch(&strRamp_emplid, &numRamp_empl_rcd, &strRamp_hr_status, &strRamp_empl_status, &strRamp_elig_config5, &strRamp_emailid, &strRamp_first_name, &strRamp_last_name, &strRamp_manager, &strRamp_location, &strRamp_manager_id, &strRamp_phone, &strRamp_deptid, &strRamp_chartfield1, &strRamp_chartfield2, &strRamp_chartfield3, &strRamp_product, &strRamp_operating_unit, &strRamp_company, &datetimeRamp_last_update_dttm, &dateRamp_termination_dt, &dateRamp_asgn_end_dt, &strRamp_text254, &strRamp_status)
      rem &strRequestString = GetHTMLText(HTML.DX_RAMP_USER_POST_REQ, &strRamp_TempUserID, &strRamp_deptid, &strRamp_location, &strRamp_manager, &strRamp_first_name, &strRamp_last_name, &strRamp_emailid, "true", "BUSINESS_USER");
      &strRamp_deptid = "Operations";
      &strRamp_location = "USCORP";
      &strRamp_first_name = "Cristiano";
      &strRamp_last_name = "LastName_" | Int(Rand() * 100);
      &strIsManager = "true";
      &strRamp_Role = "BUSINESS_USER";
      
      SQLExec("SELECT D.DX_RAMP_DEP_ID FROM PS_DX_RAMP_DEPT D WHERE D.DEPTID = :1 ", &strRamp_deptid, &strRamp_deptid);
      SQLExec("SELECT L.DX_RAMP_LOC_ID FROM PS_DX_RAMP_LOC L WHERE L.LOCATION = :1 ", &strRamp_location, &strRamp_location);
      SQLExec("SELECT U.DX_RAMP_UUID FROM PS_DX_RAMP_USER U WHERE U.EMPLOYEE_ID = :1 AND UPPER(U.MANAGER) = 'Y' ", &strRamp_manager_id, &strRamp_manager_id);
      SQLExec("SELECT U.DX_RAMP_UUID FROM PS_DX_RAMP_USER U WHERE U.EMPLOYEE_ID = :1 ", &strRamp_emplid, &strRamp_UUID);
      MessageBox(0, "", 0, 0, "&sqlPostDataSelect.RowsAffected : " | &sqlPostDataSelect.RowsAffected);
      MessageBox(0, "", 0, 0, "Custom records Email ID : " | &strRamp_emailid);
      
      &dateRamp_termination_dt = %Date;
      &strRamp_projectid = "PRJ_DX" | Int(Rand() * 100);
      &strRamp_chartfield2 = "CLINTNAME_DX" | Int(Rand() * 100);
      &strRamp_chartfield3 = "PRJNAME_DX" | Int(Rand() * 100);
      &strRamp_product = "BU01";
      
      rem &strRequestString = GetHTMLText(HTML.DX_RAMP_TEST_PATCH_REQ , &strRamp_deptid, &strRamp_manager_id, &strRamp_location, &strRamp_first_name, &strRamp_last_name, &strIsManager, &strRamp_Role); /* Used only for the testing. Comment it afterwards. */
      &strRequestString = GetHTMLText(HTML.DX_RAMP_CUST_PUT_REQ, &strRamp_emplid, &datetimeRamp_last_update_dttm, &strRamp_manager_id, &strRamp_company, &strRamp_location, &strRamp_projectid, &strRamp_operating_unit, &strRamp_chartfield1, &strRamp_chartfield2, &strRamp_chartfield3, &strRamp_product, &dateRamp_termination_dt, &strRamp_emailid);
      rem If All(&strRamp_UUID) Then;
      &jsonResponseString = %Super.SendMessage("DX_RAMP_CREC_PUT", "users", 1, &strRequestString, "");
      
      /* Create parser object */
      &js_parser = CreateJsonParser();
      
      /* Parse JSON string */
      If &js_parser.Parse(&jsonResponseString) Then
         /* Get root JSON object */
         &js_rootObj = &js_parser.GetRootObject();
         
         &recRampUser = CreateRecord(Record.DX_RAMP_USER_NW);
         &recRampUser.DX_RAMP_UUID.Value = &strRamp_UUID;
         &recRampUser.DX_RAMP_IDEMP_KEY.Value = &strRamp_UUID;
         &bValidateUserKey = &recRampUser.SelectByKey();
         
         &recRampUser.DX_RAMP_UUID.Value = &strRamp_UUID;
         &recRampUser.DX_RAMP_IDEMP_KEY.Value = &strRamp_UUID;
         &recRampUser.EMPLOYEE_ID.Value = &strRamp_emplid;
         &recRampUser.DX_RAMP_LOC_ID.Value = &strRamp_location;
         &recRampUser.DX_RAMP_ENT_ID.Value = &strRamp_company;
         &recRampUser.DX_RAMP_MGR_ID.Value = &strRamp_manager_id;
         &recRampUser.DX_RAMP_DEP_ID.Value = &strRamp_deptid;
         &recRampUser.DX_RAMP_BUS_ID.Value = &strRamp_operating_unit;
         &recRampUser.FIRST_NAME.Value = &strRamp_first_name;
         &recRampUser.LAST_NAME.Value = &strRamp_last_name;
         &recRampUser.EMAILID.Value = &strRamp_emailid;
         &recRampUser.PHONE.Value = "";
         &recRampUser.ROLENAME.Value = "BUSINESS_USER";
         &recRampUser.STATUSIMG.Value = "Custom Record Update";
         &recRampUser.MANAGER.Value = True;
         &recRampUser.LASTUPDOPRID.Value = %OperatorId;
         &recRampUser.LASTUPDDTTM.Value = %Datetime;
         If &bValidateUserKey Then
            &recRampUser.Update();
         Else
            &recRampUser.Insert();
         End-If;
         
         /* Use the extracted values - here just a message box */
         rem MessageBox(0, "", 0, 0, "ID: " | &id | Char(13) | "Name: " | &name);
      Else
         /* JSON parsing section */
      End-If;
      <*
      Else
         /* Log a message saying that there is no UUID for the employee to be updated */
      End-If;
      *>
   End-While;
   
   Return &id;
end-method; /* RampCustomRecordsUpdate */

method RampUsersUpdate
   /+ Returns String +/
   
   Local string &id;
   Local string &jsonResponseString;
   Local integer &nbPostCount;
   Local SQL &sqlPostDataSelect;
   Local Record &recRampUser;
   
   Local Document &docUriDocument;
   Local Compound &comUriCompound;
   
   Local JsonParser &js_parser;
   Local JsonObject &js_rootObj;
   Local JsonArray &js_DataArray;
   Local JsonObject &js_DataObj;
   Local JsonObject &pageObj;
   
   Local integer &ui;
   Local string &tokenType, &accessToken;
   Local string &nextUrl;
   
   Local string &strRequestString;
   Local string &strRamp_UUID;
   Local string &strRamp_TempUserID;
   Local string &strRamp_emplid;
   Local number &numRamp_empl_rcd;
   Local string &strRamp_hr_status;
   Local string &strRamp_empl_status;
   Local string &strRamp_elig_config5;
   Local string &strRamp_emailid;
   Local string &strRamp_first_name;
   Local string &strRamp_last_name;
   Local string &strRamp_manager;
   Local string &strRamp_location;
   Local string &strRamp_manager_id;
   Local string &strRamp_phone;
   Local string &strRamp_deptid;
   Local string &strRamp_chartfield1;
   Local string &strRamp_chartfield2;
   Local string &strRamp_chartfield3;
   Local string &strRamp_product;
   Local string &strRamp_operating_unit;
   Local string &strRamp_company;
   Local datetime &datetimeRamp_last_update_dttm;
   Local date &dateRamp_termination_dt;
   Local date &dateRamp_asgn_end_dt;
   Local string &strRamp_text254;
   Local string &strRamp_status;
   Local string &strRamp_Role;
   
   Local boolean &bValidateUserKey;
   Local string &strIsManager;
   Local string &strRamp_Action;
   Local string &strRamp_projectid;
   
   SQLExec(SQL.DX_RAMP_UP_CH_SQL, &nbPostCount);
   If &nbPostCount > 0 Then
      &sqlPostDataSelect = CreateSQL(SQL.DX_RAMP_UP_SQL);
   Else
      rem MessageBox(0, "", 0, 0, "Given Data already exist in the PeopleSoft system. Create new account is invalid, try update the account.");
      MessageBox(0, "", 0, 0, MsgGetExplainText(20020, 6, "Update data not available"));
   End-If;
   &strRamp_TempUserID = "LastName_" | Int(Rand() * 100);
   While &sqlPostDataSelect.Fetch(&strRamp_emplid, &numRamp_empl_rcd, &strRamp_hr_status, &strRamp_empl_status, &strRamp_elig_config5, &strRamp_emailid, &strRamp_first_name, &strRamp_last_name, &strRamp_manager, &strRamp_location, &strRamp_manager_id, &strRamp_phone, &strRamp_deptid, &strRamp_chartfield1, &strRamp_chartfield2, &strRamp_chartfield3, &strRamp_product, &strRamp_operating_unit, &strRamp_company, &datetimeRamp_last_update_dttm, &dateRamp_termination_dt, &dateRamp_asgn_end_dt, &strRamp_text254, &strRamp_status)
      rem While &sqlPostDataSelect.Fetch(&strRamp_emplid, &numRamp_empl_rcd, &strRamp_hr_status, &strRamp_empl_status, &strRamp_elig_config5, &strRamp_emailid, &strRamp_first_name, &strRamp_last_name, &strRamp_manager, &strRamp_location, &strRamp_manager_id, &strRamp_phone, &strRamp_deptid, &strRamp_chartfield1, &strRamp_chartfield2, &strRamp_chartfield3, &strRamp_product, &strRamp_projectid, &strRamp_operating_unit, &strRamp_company, &datetimeRamp_last_update_dttm, &dateRamp_termination_dt, &dateRamp_asgn_end_dt, &strRamp_Action, &strRamp_text254, &strRamp_status)
      rem &strRequestString = GetHTMLText(HTML.DX_RAMP_USER_POST_REQ, &strRamp_TempUserID, &strRamp_deptid, &strRamp_location, &strRamp_manager, &strRamp_first_name, &strRamp_last_name, &strRamp_emailid, "true", "BUSINESS_USER");
      &strRamp_deptid = "Operations";
      &strRamp_location = "USCORP";
      &strRamp_first_name = "Cristiano";
      &strRamp_last_name = "LastName_" | Int(Rand() * 100);
      &strIsManager = "true";
      &strRamp_Role = "BUSINESS_USER";
      
      SQLExec("SELECT D.DX_RAMP_DEP_ID FROM PS_DX_RAMP_DEPT D WHERE D.DEPTID = :1 ", &strRamp_deptid, &strRamp_deptid);
      SQLExec("SELECT L.DX_RAMP_LOC_ID FROM PS_DX_RAMP_LOC L WHERE L.LOCATION = :1 ", &strRamp_location, &strRamp_location);
      SQLExec("SELECT U.DX_RAMP_UUID FROM PS_DX_RAMP_USER U WHERE U.EMPLOYEE_ID = :1 AND UPPER(U.MANAGER) = 'Y' ", &strRamp_manager_id, &strRamp_manager_id);
      SQLExec("SELECT U.DX_RAMP_UUID FROM PS_DX_RAMP_USER U WHERE U.EMPLOYEE_ID = :1 ", &strRamp_emplid, &strRamp_UUID);
      MessageBox(0, "", 0, 0, "&strRamp_emplid : " | &strRamp_emplid);
      MessageBox(0, "", 0, 0, "&strRamp_UUID : " | &strRamp_UUID);
      
      &strRequestString = GetHTMLText(HTML.DX_RAMP_CUST_PUT_REQ, &strRamp_deptid, &strRamp_manager_id, &strRamp_location, &strRamp_first_name, &strRamp_last_name, &strIsManager, &strRamp_Role); /* Used only for the testing. Comment it afterwards. */
      If All(&strRamp_UUID) Then
         &jsonResponseString = %Super.SendMessage("DX_RAMP_USER_PATCH", &strRamp_UUID, 1, &strRequestString, "");
         
         /* Create parser object */
         &js_parser = CreateJsonParser();
         
         /* Parse JSON string */
         If &js_parser.Parse(&jsonResponseString) Then
            /* Get root JSON object */
            &js_rootObj = &js_parser.GetRootObject();
            &id = &js_rootObj.GetString("user_id");
            
            MessageBox(0, "", 0, 0, "New User &id : " | &id);
            &recRampUser = CreateRecord(Record.DX_RAMP_USER_NW);
            &recRampUser.DX_RAMP_UUID.Value = &strRamp_UUID;
            &recRampUser.DX_RAMP_IDEMP_KEY.Value = &strRamp_UUID;
            &bValidateUserKey = &recRampUser.SelectByKey();
            
            &recRampUser.DX_RAMP_UUID.Value = &strRamp_UUID;
            &recRampUser.DX_RAMP_IDEMP_KEY.Value = &strRamp_UUID;
            &recRampUser.EMPLOYEE_ID.Value = &strRamp_emplid;
            &recRampUser.DX_RAMP_LOC_ID.Value = &strRamp_location;
            &recRampUser.DX_RAMP_ENT_ID.Value = &strRamp_company;
            &recRampUser.DX_RAMP_MGR_ID.Value = &strRamp_manager_id;
            &recRampUser.DX_RAMP_DEP_ID.Value = &strRamp_deptid;
            &recRampUser.DX_RAMP_BUS_ID.Value = &strRamp_operating_unit;
            &recRampUser.FIRST_NAME.Value = &strRamp_first_name;
            &recRampUser.LAST_NAME.Value = &strRamp_last_name;
            &recRampUser.EMAILID.Value = &strRamp_emailid;
            &recRampUser.PHONE.Value = "";
            &recRampUser.ROLENAME.Value = "BUSINESS_USER";
            &recRampUser.STATUSIMG.Value = "Update";
            &recRampUser.MANAGER.Value = True;
            &recRampUser.LASTUPDOPRID.Value = %OperatorId;
            &recRampUser.LASTUPDDTTM.Value = %Datetime;
            If &bValidateUserKey Then
               &recRampUser.Update();
            Else
               &recRampUser.Insert();
            End-If;
            
            /* Use the extracted values - here just a message box */
            rem MessageBox(0, "", 0, 0, "ID: " | &id | Char(13) | "Name: " | &name);
         Else
            /* JSON parsing section */
         End-If;
      Else
         /* Log a message saying that there is no UUID for the employee to be updated */
      End-If;
   End-While;
   
   Return &id;
end-method;


method RampUsersRehire
   /+ Returns String +/
   
   Local string &id;
   Local string &jsonResponseString;
   Local integer &nbPostCount;
   Local SQL &sqlPostDataSelect;
   Local Record &recRampUser;
   
   Local Document &docUriDocument;
   Local Compound &comUriCompound;
   
   Local JsonParser &js_parser;
   Local JsonObject &js_rootObj;
   Local JsonArray &js_DataArray;
   Local JsonObject &js_DataObj;
   Local JsonObject &pageObj;
   
   Local integer &ui;
   Local string &tokenType, &accessToken;
   Local string &nextUrl;
   
   Local string &strRequestString;
   Local string &strRamp_UUID;
   Local string &strRamp_TempUserID;
   Local string &strRamp_emplid;
   Local number &numRamp_empl_rcd;
   Local string &strRamp_hr_status;
   Local string &strRamp_empl_status;
   Local string &strRamp_elig_config5;
   Local string &strRamp_emailid;
   Local string &strRamp_first_name;
   Local string &strRamp_last_name;
   Local string &strRamp_manager;
   Local string &strRamp_location;
   Local string &strRamp_manager_id;
   Local string &strRamp_phone;
   Local string &strRamp_deptid;
   Local string &strRamp_chartfield1;
   Local string &strRamp_chartfield2;
   Local string &strRamp_chartfield3;
   Local string &strRamp_product;
   Local string &strRamp_operating_unit;
   Local string &strRamp_company;
   Local datetime &datetimeRamp_last_update_dttm;
   Local date &dateRamp_termination_dt;
   Local date &dateRamp_asgn_end_dt;
   Local string &strRamp_text254;
   Local string &strRamp_status;
   Local string &strRamp_Role;
   
   Local boolean &bValidateUserKey;
   Local string &strIsManager;
   
   SQLExec(SQL.DX_RAMP_RH_CH_SQL, &nbPostCount);
   If &nbPostCount > 0 Then
      &sqlPostDataSelect = CreateSQL(SQL.DX_RAMP_RH_SQL);
   Else
      rem MessageBox(0, "", 0, 0, "Given Data already exist in the PeopleSoft system. Create new account is invalid, try update the account.");
      MessageBox(0, "", 0, 0, MsgGetExplainText(20020, 6, "Rehire data not available"));
   End-If;
   &strRamp_TempUserID = "LastName_" | Int(Rand() * 100);
   While &sqlPostDataSelect.Fetch(&strRamp_emplid, &numRamp_empl_rcd, &strRamp_hr_status, &strRamp_empl_status, &strRamp_elig_config5, &strRamp_emailid, &strRamp_first_name, &strRamp_last_name, &strRamp_manager, &strRamp_location, &strRamp_manager_id, &strRamp_phone, &strRamp_deptid, &strRamp_chartfield1, &strRamp_chartfield2, &strRamp_chartfield3, &strRamp_product, &strRamp_operating_unit, &strRamp_company, &datetimeRamp_last_update_dttm, &dateRamp_termination_dt, &dateRamp_asgn_end_dt, &strRamp_text254, &strRamp_status)
      rem &strRequestString = GetHTMLText(HTML.DX_RAMP_USER_POST_REQ, &strRamp_TempUserID, &strRamp_deptid, &strRamp_location, &strRamp_manager, &strRamp_first_name, &strRamp_last_name, &strRamp_emailid, "true", "BUSINESS_USER");
      &strRamp_deptid = "031";
      &strRamp_location = "USCORP";
      &strRamp_first_name = "Cristiano";
      &strRamp_last_name = "LastName_" | Int(Rand() * 100);
      &strIsManager = "false";
      &strRamp_Role = "BUSINESS_USER";
      
      SQLExec("SELECT D.DX_RAMP_DEP_ID FROM PS_DX_RAMP_DEPT D WHERE D.DEPTID = :1 ", &strRamp_deptid, &strRamp_deptid);
      SQLExec("SELECT L.DX_RAMP_LOC_ID FROM PS_DX_RAMP_LOC L WHERE L.LOCATION = :1 ", &strRamp_location, &strRamp_location);
      SQLExec("SELECT U.DX_RAMP_UUID FROM PS_DX_RAMP_USER U WHERE U.EMPLOYEE_ID = :1 AND UPPER(U.MANAGER) = 'Y' ", &strRamp_manager_id, &strRamp_manager_id);
      SQLExec("SELECT U.DX_RAMP_UUID FROM PS_DX_RAMP_USER U WHERE U.EMPLOYEE_ID = :1 ", &strRamp_emplid, &strRamp_UUID);
      MessageBox(0, "", 0, 0, "&strRamp_emplid : " | &strRamp_emplid);
      MessageBox(0, "", 0, 0, "&strRamp_UUID : " | &strRamp_UUID);
      
      &strRequestString = GetHTMLText(HTML.DX_RAMP_TEST_PATCH_REQ, &strRamp_deptid, &strRamp_manager_id, &strRamp_location, &strRamp_first_name, &strRamp_last_name, &strIsManager, &strRamp_Role); /* Used only for the testing. Comment it afterwards. */
      If All(&strRamp_UUID) Then
         &jsonResponseString = %Super.SendMessage("DX_RAMP_USER_PATCH", &strRamp_UUID, 3, "", "");
         
         &recRampUser = CreateRecord(Record.DX_RAMP_USER_NW);
         &recRampUser.DX_RAMP_UUID.Value = &strRamp_UUID;
         &recRampUser.DX_RAMP_IDEMP_KEY.Value = &strRamp_UUID;
         &bValidateUserKey = &recRampUser.SelectByKey();
         
         &recRampUser.DX_RAMP_UUID.Value = &strRamp_UUID;
         &recRampUser.DX_RAMP_IDEMP_KEY.Value = &strRamp_UUID;
         &recRampUser.EMPLOYEE_ID.Value = &strRamp_emplid;
         &recRampUser.DX_RAMP_LOC_ID.Value = &strRamp_location;
         &recRampUser.DX_RAMP_ENT_ID.Value = &strRamp_company;
         &recRampUser.DX_RAMP_MGR_ID.Value = &strRamp_manager_id;
         &recRampUser.DX_RAMP_DEP_ID.Value = &strRamp_deptid;
         &recRampUser.DX_RAMP_BUS_ID.Value = &strRamp_operating_unit;
         &recRampUser.FIRST_NAME.Value = &strRamp_first_name;
         &recRampUser.LAST_NAME.Value = &strRamp_last_name;
         &recRampUser.EMAILID.Value = &strRamp_emailid;
         &recRampUser.PHONE.Value = "";
         &recRampUser.ROLENAME.Value = "BUSINESS_USER";
         &recRampUser.STATUSIMG.Value = "Rehire";
         &recRampUser.MANAGER.Value = True;
         &recRampUser.LASTUPDOPRID.Value = %OperatorId;
         &recRampUser.LASTUPDDTTM.Value = %Datetime;
         If &bValidateUserKey Then
            &recRampUser.Update();
         Else
            &recRampUser.Insert();
         End-If;
         
      Else
         /* Log a message saying that there is no UUID for the employee to be updated */
      End-If;
   End-While;
   
   Return &id;
end-method;


method RampUsersTerm
   /+ Returns String +/
   
   Local string &id;
   Local string &jsonResponseString;
   Local integer &nbPostCount;
   Local SQL &sqlPostDataSelect;
   Local Record &recRampUser;
   
   Local Document &docUriDocument;
   Local Compound &comUriCompound;
   
   Local JsonParser &js_parser;
   Local JsonObject &js_rootObj;
   Local JsonArray &js_DataArray;
   Local JsonObject &js_DataObj;
   Local JsonObject &pageObj;
   
   Local integer &ui;
   Local string &tokenType, &accessToken;
   Local string &nextUrl;
   
   Local string &strRequestString;
   Local string &strRamp_UUID;
   Local string &strRamp_TempUserID;
   Local string &strRamp_emplid;
   Local number &numRamp_empl_rcd;
   Local string &strRamp_hr_status;
   Local string &strRamp_empl_status;
   Local string &strRamp_elig_config5;
   Local string &strRamp_emailid;
   Local string &strRamp_first_name;
   Local string &strRamp_last_name;
   Local string &strRamp_manager;
   Local string &strRamp_location;
   Local string &strRamp_manager_id;
   Local string &strRamp_phone;
   Local string &strRamp_deptid;
   Local string &strRamp_chartfield1;
   Local string &strRamp_chartfield2;
   Local string &strRamp_chartfield3;
   Local string &strRamp_product;
   Local string &strRamp_operating_unit;
   Local string &strRamp_company;
   Local datetime &datetimeRamp_last_update_dttm;
   Local date &dateRamp_termination_dt;
   Local date &dateRamp_asgn_end_dt;
   Local string &strRamp_text254;
   Local string &strRamp_status;
   Local string &strRamp_Role;
   
   Local boolean &bValidateUserKey;
   Local string &strIsManager;
   
   SQLExec(SQL.DX_RAMP_TR_CH_SQL, &nbPostCount);
   If &nbPostCount > 0 Then
      &sqlPostDataSelect = CreateSQL(SQL.DX_RAMP_TR_SQL);
   Else
      rem MessageBox(0, "", 0, 0, "Given Data already exist in the PeopleSoft system. Create new account is invalid, try update the account.");
      MessageBox(0, "", 0, 0, MsgGetExplainText(20020, 6, "Termination data not available"));
   End-If;
   &strRamp_TempUserID = "LastName_" | Int(Rand() * 100);
   While &sqlPostDataSelect.Fetch(&strRamp_emplid, &numRamp_empl_rcd, &strRamp_hr_status, &strRamp_empl_status, &strRamp_elig_config5, &strRamp_emailid, &strRamp_first_name, &strRamp_last_name, &strRamp_manager, &strRamp_location, &strRamp_manager_id, &strRamp_phone, &strRamp_deptid, &strRamp_chartfield1, &strRamp_chartfield2, &strRamp_chartfield3, &strRamp_product, &strRamp_operating_unit, &strRamp_company, &datetimeRamp_last_update_dttm, &dateRamp_termination_dt, &dateRamp_asgn_end_dt, &strRamp_text254, &strRamp_status)
      rem &strRequestString = GetHTMLText(HTML.DX_RAMP_USER_POST_REQ, &strRamp_TempUserID, &strRamp_deptid, &strRamp_location, &strRamp_manager, &strRamp_first_name, &strRamp_last_name, &strRamp_emailid, "true", "BUSINESS_USER");
      &strRamp_deptid = "031";
      &strRamp_location = "USCORP";
      &strRamp_first_name = "Cristiano";
      &strRamp_last_name = "LastName_" | Int(Rand() * 100);
      &strIsManager = "false";
      &strRamp_Role = "BUSINESS_USER";
      
      SQLExec("SELECT D.DX_RAMP_DEP_ID FROM PS_DX_RAMP_DEPT D WHERE D.DEPTID = :1 ", &strRamp_deptid, &strRamp_deptid);
      SQLExec("SELECT L.DX_RAMP_LOC_ID FROM PS_DX_RAMP_LOC L WHERE L.LOCATION = :1 ", &strRamp_location, &strRamp_location);
      SQLExec("SELECT U.DX_RAMP_UUID FROM PS_DX_RAMP_USER U WHERE U.EMPLOYEE_ID = :1 AND UPPER(U.MANAGER) = 'Y' ", &strRamp_manager_id, &strRamp_manager_id);
      SQLExec("SELECT U.DX_RAMP_UUID FROM PS_DX_RAMP_USER U WHERE U.EMPLOYEE_ID = :1 ", &strRamp_emplid, &strRamp_UUID);
      MessageBox(0, "", 0, 0, "&strRamp_emplid : " | &strRamp_emplid);
      MessageBox(0, "", 0, 0, "&strRamp_UUID : " | &strRamp_UUID);
      
      &strRequestString = GetHTMLText(HTML.DX_RAMP_TEST_PATCH_REQ, &strRamp_deptid, &strRamp_manager_id, &strRamp_location, &strRamp_first_name, &strRamp_last_name, &strIsManager, &strRamp_Role); /* Used only for the testing. Comment it afterwards. */
      If All(&strRamp_UUID) Then
         &jsonResponseString = %Super.SendMessage("DX_RAMP_USER_PATCH", &strRamp_UUID, 2, "", "");
         
         
         &recRampUser = CreateRecord(Record.DX_RAMP_USER_NW);
         &recRampUser.DX_RAMP_UUID.Value = &strRamp_UUID;
         &recRampUser.DX_RAMP_IDEMP_KEY.Value = &strRamp_UUID;
         &bValidateUserKey = &recRampUser.SelectByKey();
         
         &recRampUser.DX_RAMP_UUID.Value = &strRamp_UUID;
         &recRampUser.DX_RAMP_IDEMP_KEY.Value = &strRamp_UUID;
         &recRampUser.EMPLOYEE_ID.Value = &strRamp_emplid;
         &recRampUser.DX_RAMP_LOC_ID.Value = &strRamp_location;
         &recRampUser.DX_RAMP_ENT_ID.Value = &strRamp_company;
         &recRampUser.DX_RAMP_MGR_ID.Value = &strRamp_manager_id;
         &recRampUser.DX_RAMP_DEP_ID.Value = &strRamp_deptid;
         &recRampUser.DX_RAMP_BUS_ID.Value = &strRamp_operating_unit;
         &recRampUser.FIRST_NAME.Value = &strRamp_first_name;
         &recRampUser.LAST_NAME.Value = &strRamp_last_name;
         &recRampUser.EMAILID.Value = &strRamp_emailid;
         &recRampUser.PHONE.Value = "";
         &recRampUser.ROLENAME.Value = "BUSINESS_USER";
         &recRampUser.STATUSIMG.Value = "Termination";
         &recRampUser.MANAGER.Value = True;
         &recRampUser.LASTUPDOPRID.Value = %OperatorId;
         &recRampUser.LASTUPDDTTM.Value = %Datetime;
         If &bValidateUserKey Then
            &recRampUser.Update();
         Else
            &recRampUser.Insert();
         End-If;
      Else
         /* Log a message saying that there is no UUID for the employee to be updated */
      End-If;
   End-While;
   
   Return &id;
end-method;


method RampUsersGet
   /+ Returns String +/
   
   Local string &id;
   Local string &jsonResponseString;
   Local integer &nbPostCount;
   Local SQL &sqlPostDataSelect;
   Local Record &recRampUser;
   
   Local Document &docUriDocument;
   Local Compound &comUriCompound;
   
   Local JsonParser &js_parser;
   Local JsonObject &js_rootObj;
   Local JsonArray &js_DataArray;
   Local JsonObject &js_DataObj;
   Local JsonObject &pageObj;
   
   Local JsonArray &js_CustomFieldsArray;
   Local JsonObject &js_CustomFieldsObj;
   Local number &j;
   Local string &strCustomName;
   Local string &strCustomValue;
   
   Local integer &ui;
   Local string &tokenType, &accessToken;
   Local string &nextUrl;
   
   Local string &strRequestString;
   Local string &strRamp_TempUserID;
   Local string &strRamp_emplid;
   Local number &numRamp_empl_rcd;
   Local string &strRamp_hr_status;
   Local string &strRamp_empl_status;
   Local string &strRamp_elig_config5;
   Local string &strRamp_emailid;
   Local string &strRamp_first_name;
   Local string &strRamp_last_name;
   Local boolean &bRamp_Ismanager;
   Local string &strRamp_Ismanager;
   Local string &strRamp_location;
   Local string &strRamp_manager_id;
   Local string &strRamp_phone;
   Local string &strRamp_deptid;
   Local string &strRamp_chartfield1;
   Local string &strRamp_chartfield2;
   Local string &strRamp_chartfield3;
   Local string &strRamp_product;
   Local string &strRamp_operating_unit;
   Local string &strRamp_company;
   Local datetime &datetimeRamp_last_update_dttm;
   Local date &dateRamp_termination_dt;
   Local date &dateRamp_asgn_end_dt;
   Local string &strRamp_text254;
   Local string &strRamp_status;
   Local string &strRamp_role;
   Local string &strRamp_entity_id;
   Local string &strRamp_business_id;
   
   Local boolean &bIsJsonArr;
   Local boolean &bIsJsonArr_CustomFields;
   Local boolean &bValidateUserGetKey;
   Local number &i;
   
   &jsonResponseString = %Super.SendMessage("DX_RAMP_USER_GET", "", 1, "", "");
   
   /* Create parser object */
   &js_parser = CreateJsonParser();
   
   /* Parse JSON string */
   If &js_parser.Parse(&jsonResponseString) Then
      /* Get root JSON object */
      &js_rootObj = &js_parser.GetRootObject();
      &bIsJsonArr = &js_rootObj.IsJsonArray("data");
      MessageBox(0, "", 0, 0, "Is Resources array present - " | &bIsJsonArr | " - " | &js_rootObj.GetJsonArray("data").Length());
      If &bIsJsonArr Then
         &js_DataArray = &js_rootObj.GetJsonArray("data");
         
         /* Loop through the array elements */
         For &i = 1 To &js_DataArray.Length()
            /* Get each JSON object in the array */
            &js_DataObj = &js_DataArray.GetJsonObject(&i);
            
            /* Extract data from the object */
            If &js_DataObj.IsNullProperty("department_id") Then
               &strRamp_deptid = "";
            Else
               &strRamp_deptid = &js_DataObj.GetString("department_id");
            End-If;
            If &js_DataObj.IsNullProperty("last_name") Then
               &strRamp_last_name = "";
            Else
               &strRamp_last_name = &js_DataObj.GetString("last_name");
            End-If;
            If &js_DataObj.IsNullProperty("location_id") Then
               &strRamp_location = "";
            Else
               &strRamp_location = &js_DataObj.GetString("location_id");
            End-If;
            
            &bIsJsonArr_CustomFields = &js_DataObj.IsJsonArray("custom_fields");
            If &bIsJsonArr_CustomFields Then
               &js_CustomFieldsArray = &js_DataObj.GetJsonArray("custom_fields");
               If &js_CustomFieldsArray.Length() > 0 Then
                  /* Loop through the array elements if there is data*/
                  For &j = 1 To &js_CustomFieldsArray.Length()
                     &js_CustomFieldsObj = &js_CustomFieldsArray.GetJsonObject(&j);
                     If &js_CustomFieldsObj.IsNullProperty("name") Then
                        &strCustomName = "";
                     Else
                        &strCustomName = &js_CustomFieldsObj.GetString("name");
                     End-If;
                     If &js_CustomFieldsObj.IsNullProperty("value") Then
                        &strCustomValue = "";
                     Else
                        &strCustomValue = &js_CustomFieldsObj.GetString("value");
                     End-If;
                  End-For;
               End-If;
            End-If;
            If &js_DataObj.IsNullProperty("phone") Then
               &strRamp_phone = "";
            Else
               &strRamp_phone = &js_DataObj.GetString("phone");
            End-If;
            If &js_DataObj.IsNullProperty("role") Then
               &strRamp_role = "";
            Else
               &strRamp_role = &js_DataObj.GetString("role");
            End-If;
            If &js_DataObj.IsNullProperty("email") Then
               &strRamp_emailid = "";
            Else
               &strRamp_emailid = &js_DataObj.GetString("email");
            End-If;
            If &js_DataObj.IsNullProperty("id") Then
               &id = "";
            Else
               &id = &js_DataObj.GetString("id");
            End-If;
            If &js_DataObj.IsNullProperty("entity_id") Then
               &strRamp_entity_id = "";
            Else
               &strRamp_entity_id = &js_DataObj.GetString("entity_id");
            End-If;
            If &js_DataObj.IsNullProperty("business_id") Then
               &strRamp_business_id = "";
            Else
               &strRamp_business_id = &js_DataObj.GetString("business_id");
            End-If;
            If &js_DataObj.IsNullProperty("status") Then
               &strRamp_status = "";
            Else
               &strRamp_status = &js_DataObj.GetString("status");
            End-If;
            If &js_DataObj.IsNullProperty("employee_id") Then
               &strRamp_emplid = "";
            Else
               &strRamp_emplid = &js_DataObj.GetString("employee_id");
            End-If;
            If &js_DataObj.IsNullProperty("first_name") Then
               &strRamp_first_name = "";
            Else
               &strRamp_first_name = &js_DataObj.GetString("first_name");
            End-If;
            If &js_DataObj.IsNullProperty("is_manager") Then
               &bRamp_Ismanager = False;
            Else
               &bRamp_Ismanager = &js_DataObj.GetBoolean("is_manager");
            End-If;
            If &bRamp_Ismanager Then
               &strRamp_Ismanager = "Y"
            Else
               &strRamp_Ismanager = "N"
            End-If;
            
            If &js_DataObj.IsNullProperty("manager_id") Then
               &strRamp_manager_id = "";
            Else
               &strRamp_manager_id = &js_DataObj.GetString("manager_id");
            End-If;
            
            
            REM MessageBox(0, "", 0, 0, "New User &id : " | &id);
            &recRampUser = CreateRecord(Record.DX_RAMP_USER);
            &recRampUser.DX_RAMP_UUID.Value = &id;
            &bValidateUserGetKey = &recRampUser.SelectByKey();
            
            &recRampUser.DX_RAMP_UUID.Value = &id;
            &recRampUser.EMPLOYEE_ID.Value = &strRamp_emplid;
            &recRampUser.DX_RAMP_LOC_ID.Value = &strRamp_location;
            &recRampUser.DX_RAMP_ENT_ID.Value = &strRamp_company;
            &recRampUser.EMAILID.Value = &strRamp_emailid;
            
            &recRampUser.DX_RAMP_MGR_ID.Value = &strRamp_manager_id;
            &recRampUser.DX_RAMP_DEP_ID.Value = &strRamp_deptid;
            &recRampUser.DX_RAMP_BUS_ID.Value = &strRamp_business_id;
            &recRampUser.FIRST_NAME.Value = &strRamp_first_name;
            &recRampUser.LAST_NAME.Value = &strRamp_last_name;
            &recRampUser.PHONE.Value = &strRamp_phone;
            &recRampUser.ROLENAME.Value = &strRamp_role;
            &recRampUser.STATUSIMG.Value = &strRamp_status;
            &recRampUser.MANAGER.Value = &strRamp_Ismanager;
            &recRampUser.LASTUPDOPRID.Value = %OperatorId;
            &recRampUser.LASTUPDDTTM.Value = %Datetime;
            If &bValidateUserGetKey Then
               &recRampUser.Update();
               MessageBox(0, "", 0, 0, "Update - " | &id);
            Else
               &recRampUser.Insert();
               MessageBox(0, "", 0, 0, "Insert - " | &id);
            End-If;
         End-For;
      Else
      End-If;
      
      
      /* Use the extracted values - here just a message box */
      rem MessageBox(0, "", 0, 0, "ID: " | &id | Char(13) | "Name: " | &name);
   Else
   End-If;
   
   Return %Super.propstr_GeneratedAccessToken;
end-method;

method RampDepartment
   /+ Returns String +/
   
   Local string &jsonResponseString;
   Local string &id;
   Local string &name;
   
   Local Document &docUriDocument;
   Local Compound &comUriCompound;
   
   Local JsonParser &js_parser;
   Local JsonObject &js_rootObj;
   Local JsonArray &js_DataArray;
   Local JsonObject &js_DataObj;
   Local JsonObject &pageObj;
   Local boolean &bIsJsonArr;
   
   Local integer &i;
   Local string &tokenType, &accessToken;
   Local string &nextUrl;
   Local Record &recRampDept;
   
   &jsonResponseString = %Super.SendMessage("DX_RAMP_DEPT_GET", "", 1, "", "");
   
   /* Create parser object */
   &js_parser = CreateJsonParser();
   
   /* Parse JSON string */
   If &js_parser.Parse(&jsonResponseString) Then
      /* Get root JSON object */
      &js_rootObj = &js_parser.GetRootObject();
      
      /* Get the "data" JSON array */
      &bIsJsonArr = &js_rootObj.IsJsonArray("data");
      MessageBox(0, "", 0, 0, "Is Resources array present - " | &bIsJsonArr | " - " | &js_rootObj.GetJsonArray("data").Length());
      If &bIsJsonArr Then
         &js_DataArray = &js_rootObj.GetJsonArray("data");
         
         /* Loop through the array elements */
         For &i = 1 To &js_DataArray.Length()
            /* Get each JSON object in the array */
            &js_DataObj = &js_DataArray.GetJsonObject(&i);
            
            /* Extract id and name from the object */
            If &js_DataObj.IsNullProperty("id") Then
               &id = "";
            Else
               &id = &js_DataObj.GetString("id");
            End-If;
            If &js_DataObj.IsNullProperty("name") Then
               &name = "";
            Else
               &name = &js_DataObj.GetString("name");
            End-If;
            If All(&id) Then
               &recRampDept = CreateRecord(Record.DX_RAMP_DEPT);
               &recRampDept.DX_RAMP_DEP_ID.Value = &id;
               &recRampDept.DEPTID.Value = &name;
               REM &recRampDept.DEPARTMENT.Value = &name;
               
               If Not &recRampDept.SelectByKey() Then
                  &recRampDept.DX_RAMP_DEP_ID.Value = &id;
                  &recRampDept.DEPTID.Value = &name;
                  &recRampDept.DESCR100.Value = "";
                  &recRampDept.LASTUPDOPRID.Value = %OperatorId;
                  &recRampDept.LASTUPDDTTM.Value = %Datetime;
                  &recRampDept.Insert();
               Else
               End-If;
            End-If;
            /* Use the extracted values - here just a message box */
            rem MessageBox(0, "", 0, 0, "ID: " | &id | Char(13) | "Name: " | &name);
         End-For;
         
         /* Get the "page" JSON object */
         &pageObj = &js_rootObj.GetJsonObject("page");
         
         /* Extract the "next" string */
         If &pageObj.IsNullProperty("next") Then
            &nextUrl = "";
         Else
            &nextUrl = &pageObj.GetString("next");
         End-If;
         
         /* Show the next page URL */
         rem MessageBox(0, "", 0, 0, "Next URL: " | &nextUrl);
      Else
      End-If;
   Else
   End-If;
   
   Return &id;
end-method;

method RampLocation
   /+ Returns String +/
   Local string &jsonResponseString;
   Local string &Loc_id;
   Local string &Loc_name;
   Local string &Loc_entity_id;
   
   Local Document &docUriDocument;
   Local Compound &comUriCompound;
   
   Local JsonParser &js_parser;
   Local JsonObject &js_rootObj;
   Local JsonArray &js_DataArray;
   Local JsonObject &js_DataObj;
   Local JsonObject &pageObj;
   Local boolean &bIsJsonArr;
   
   Local integer &i;
   Local string &tokenType, &accessToken;
   Local string &nextUrl;
   Local Record &recRampLoc;
   
   &jsonResponseString = %Super.SendMessage("DX_RAMP_LOC_GET", "", 1, "", "");
   
   /* Create parser object */
   &js_parser = CreateJsonParser();
   
   /* Parse JSON string */
   If &js_parser.Parse(&jsonResponseString) Then
      /* Get root JSON object */
      &js_rootObj = &js_parser.GetRootObject();
      
      
      &bIsJsonArr = &js_rootObj.IsJsonArray("data");
      MessageBox(0, "", 0, 0, "Is Resources array present - " | &bIsJsonArr | " - " | &js_rootObj.GetJsonArray("data").Length());
      If &bIsJsonArr Then
         &js_DataArray = &js_rootObj.GetJsonArray("data");
         
         /* Loop through the array elements */
         For &i = 1 To &js_DataArray.Length()
            /* Get each JSON object in the array */
            &js_DataObj = &js_DataArray.GetJsonObject(&i);
            
            /* Extract id and name from the object */
            If &js_DataObj.IsNullProperty("id") Then
               &Loc_id = "";
            Else
               &Loc_id = &js_DataObj.GetString("id");
            End-If;
            If &js_DataObj.IsNullProperty("name") Then
               &Loc_name = "";
            Else
               &Loc_name = &js_DataObj.GetString("name");
            End-If;
            
            If &js_DataObj.IsNullProperty("entity_id") Then
               &Loc_entity_id = "";
            Else
               &Loc_entity_id = &js_DataObj.GetString("entity_id");
            End-If;
            
            &recRampLoc = CreateRecord(Record.DX_RAMP_LOC);
            &recRampLoc.DX_RAMP_LOC_ID.Value = &Loc_id;
            &recRampLoc.LOCATION.Value = &Loc_name;
            
            If Not &recRampLoc.SelectByKey() Then
               &recRampLoc.DX_RAMP_LOC_ID.Value = &Loc_id;
               &recRampLoc.LOCATION.Value = &Loc_name;
               &recRampLoc.DX_RAMP_ENT_ID.Value = &Loc_entity_id;
               &recRampLoc.DESCR100.Value = "";
               &recRampLoc.LASTUPDOPRID.Value = %OperatorId;
               &recRampLoc.LASTUPDDTTM.Value = %Datetime;
               &recRampLoc.Insert();
            Else
            End-If;
            
            /* Use the extracted values - here just a message box */
            rem MessageBox(0, "", 0, 0, "ID: " | &Loc_id | Char(13) | "Name: " | &Loc_name);
         End-For;
         
         /* Get the "page" JSON object */
         &pageObj = &js_rootObj.GetJsonObject("page");
         
         /* Extract the "next" string */
         If &pageObj.IsNullProperty("next") Then
            &nextUrl = "";
         Else
            &nextUrl = &pageObj.GetString("next");
         End-If;
         
         /* Show the next page URL */
         rem MessageBox(0, "", 0, 0, "Next URL: " | &nextUrl);
      Else
      End-If;
   Else
   End-If;
   Return %Super.propstr_GeneratedAccessToken;
end-method;

method RampEntity
   /+ Returns String +/
   Return %Super.propstr_GeneratedAccessToken;
end-method;

